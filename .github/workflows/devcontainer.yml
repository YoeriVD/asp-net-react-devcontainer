name: DevContainer CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  test:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
    - uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3  # v6.0.0
    
    - name: Build and run Dev Container task
      uses: devcontainers/ci@8bf61b26e9c3a98f69cb6ce2f88d24ff59b785c6  # v0.3
      with:
        runCmd: |
          # Verify Node.js is installed
          node --version
          npm --version
          
          # Verify .NET is installed
          dotnet --version
          
          # Verify sqlcmd is available and functional
          if command -v sqlcmd &> /dev/null; then
            sqlcmd -? > /dev/null 2>&1 && echo "sqlcmd is functional in PATH"
          elif [ -f /opt/mssql-tools18/bin/sqlcmd ]; then
            /opt/mssql-tools18/bin/sqlcmd -? > /dev/null 2>&1 && echo "sqlcmd is functional at /opt/mssql-tools18/bin/sqlcmd"
          elif [ -f /opt/mssql-tools/bin/sqlcmd ]; then
            /opt/mssql-tools/bin/sqlcmd -? > /dev/null 2>&1 && echo "sqlcmd is functional at /opt/mssql-tools/bin/sqlcmd"
          fi
          
          # Verify project structure
          ls -la
          
          # Test .NET restore
          dotnet restore
          
          # Test npm install
          cd react-app.client && npm install
